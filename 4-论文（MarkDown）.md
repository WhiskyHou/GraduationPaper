# 摘要

# Abstract

# 目录
* **摘要**
* **Abstract**
* **目录**
* **[第一章 绪论](#1)**
    * [选题背景及意义](#1-1)
    * [论文工作内容](#1-2)
    * [论文组织结构](#1-3)
* **[第二章 相关技术概述](#2)**
    * [游戏引擎](#2-1)
    * [Unity 游戏引擎](#2-2)
    * [Node.js 运行环境](#2-3)
    * [本章小结](#2-4)
* **第三章 需求分析**
    * 业务描述
    * 整体需求
    * 功能需求
        * 主体功能分析
        * 场景功能分析
        * 关卡功能分析
        * 地图编辑功能分析
        * 排行榜功能分析
    * 用例分析
    * 数据建模
        * 用户数据建模
        * 地图数据建模
        * 排行榜数据建模
    * 过程建模
    * 本章小结
* **第四章 游戏编辑器设计**
    * 整体结构
    * 客户端功能模块设计
    * 服务端功能模块设计
    * 本章小结
* **第五章 功能实现**
    * 资源管理
    * 角色控制实现
        * 输入设备控制模块
        * 角色行为状态模块
    * 游戏组件模块实现
        * Stone 模块
        * Spring 模块
        * Cannon 模块
        * Bullet 模块
        * Ice 模块
        * Sword 模块
        * Killer 模块
        * End 模块
    * 地图编辑器实现
        * 地图网格化
        * 实例化组件模块
        * 运行预览
        * 标准检查
    * 地图构建实现
        * 使用 JSON
        * 地图数据解析
        * 地图构建
    * 客户端用户界面交互实现
        * 用户登录
        * 查看用户地图
        * 查看公共地图
        * 查看世界排行
    * 服务端实现
        * 用户数据
        * 地图数据
        * 客户端 - 服务端 通信接口
    * 本章小结
* **第六章 功能测试**
    * 测试环境
    * 测试用例
    * 测试结果
    * 本章小结
* **第七章 结束语**
    * 论文工作总结
    * 后续工作展望

# <div id="1">第一章 绪论
## <div id="1-1"> 1.1 选题背景及意义 
目前中国国内游戏产业的发展较为迅速，《2018年中国游戏产业报告》指出中国游戏市场2018年实际销售收入达2144.4亿元，同比增长5.3%，相比2017年23%的增速有所放缓。其中，移动游戏市场实际销售收入占中国游戏市场的比例已经高达62.5%。与移动游戏市场保持增长和收入占比持续增加相反，2018年中国客户端游戏市场实际销售收入同比下降4.5%，在整个游戏市场的份额也从2017年的31.9%下降至28.9%。

从报告中可以看出，中国游戏市场仍然处于增长趋势，但是增幅的变缓和客户端游戏份额的下跌，也体现出了目前游戏产业所遇到的瓶颈。近几年，经典玩法游戏的创新匮乏，像诸如《超级马里奥》这样的二维跳台类游戏，只通过经典的关卡式玩法已经不足以维持玩家的热度。而针对二维跳台类游戏的创新，也有很好的成功案例，例如腾讯推出的手机游戏《天天酷跑》，通过扩充游戏玩法，再与社交关系链结合，成功收获了大量用户。

在近一年的软件日活跃用户排名中，前十名中有两位是短视频类软件，即抖音和快手，二者的共同特点都是 “内容创作与分享”，这说明内容创作与分享已然成为目前非常受欢迎的一种模式。将传统二维跳台类游戏与这种模式相结合，进行二次创新，其中 “内容创作” 就是玩家可以自主编辑地图、创造地图，“分享” 就是通过网络共享所有玩家的创作，并利用一些手段将所有玩家联系起来。目前利用这种方式制作的游戏有任天堂（Nintendo）公司推出的《马里奥制造》，但是由于官方只发布了 WiiU 平台，而在 PC 平台和移动平台上，还没有代表性的作品。所以本课题 “二维跳台类游戏地图编辑器” 这一围绕核心地图编辑器的游戏，在探索经典玩法游戏创新的道路上很有意义。
## <div id="1-2"> 1.2 论文工作内容
本人在项目中担任产品设计、程序实现、测试等一系列工作，工作大致内容如下：
1. 根据题目描述进行需求分析，对游戏玩法和编辑器进行设计。
2. 实现客户端中游戏游玩的部分，主要包括游戏主体、玩法逻辑、组件模块逻辑等。
3. 实现客户端中地图编辑器的部分，主要包括交互界面、编辑逻辑、数据储存等。
4. 实现服务端的功能，主要包括用户数据系统、地图数据系统、与客户端通信等。
5. 将游戏发布到 PC 平台，并在局域网部署服务器，实现游戏和编辑器的正常运行。
## <div id="1-3"> 1.3 论文组织结构
本论文主要研究了《Runner Maker》这款二维跳台类游戏及其地图编辑器的设计与实现。本文组织结构如下：

第一章为绪论部分。通过对去年中国游戏产业的现状的介绍，分析了传统游戏玩法创新的必要性，叙述了本论文的研究意义，并且说明了本人在项目中的主要工作，以及本论文的组织结构。

第二章为相关技术概述。介绍了本项目中所使用到的技术，首先对游戏引擎进行综合概述，然后对所使用的 Unity 引擎及其技术特点进行了基本介绍，最后对本项目服务端中使用的 Node.js 技术进行基本介绍。

第三章为需求分析。首先陈述了本项目的整体需求，然后针对各部分功能需求，通过用例分析、数据建模、过程建模等手段进行了详细的分析。

第四章根据需求分析进行软件设计。首先分析了本项目的整体结构，对其客户端和服务端分别进行功能划分，对各个模块进行详细设计与建模。

第五章为功能实现。首先叙述了游戏核心玩法的实现以及游戏场景模块的实现，然后对编辑器实现和地图构建模块进行了重点叙述，最后依次描述了客户端交互和服务端功能的实现。

第六章为功能测试。包括了游戏玩法测试、编辑器功能测试、服务端功能测试，并分别进行了测试总结。

第七章为结束语。对整个项目的开发以及论文的撰写进行总结，并对未来提出展望。

# <div id="2"> 第二章 相关技术概述
## <div id="2-1"> 2.1 游戏引擎
游戏引擎是指一些已经编写好的可用来编辑电脑游戏程序或者一些交互式图形应用程序的核心组件。这些组件为开发者提供了各种制作游戏时所需要用到的代码库和工具，使开发者可以花费较少的时间来制作游戏程序，减少在底层功能和高复用功能方面的工作，提高了开发效率，降低了开发难度。游戏引擎一般包括以下模块：图形渲染引擎、物理引擎、音效引擎、脚本引擎、资源管理、动画系统、网络系统、可视化编辑器等。

游戏引擎又分通用游戏引擎和专用游戏引擎。通用游戏引擎是指可以用来开发各种类型的游戏或相关图形软件的引擎，这类游戏引擎功能较为全面，使用难度也相对较高。专用游戏引擎是指用来开发特定类型的游戏或相关图形软件的引擎，能力局限性较大，但是对这类特定需求可以提供更完善的功能，同时使用难度相对较低。
## <div id="2-2"> 2.2 Unity 游戏引擎
Unity 是一款由 Unity Technologies 研发的跨平台 2D / 3D 游戏引擎，可用于开发 Windows、MacOS 及 Linux 平台的单机游戏，PlayStation、XBox、Wii、3DS 和 任天堂Switch 等游戏主机平台的视频游戏，或是 iOS、Android 等移动设备的游戏。

Unity 所支持的游戏平台还延伸到了基于 WebGL 技术的 HTML5 网页平台，以及 tvOS、Oculus Rift、ARKit 等新一代多媒体平台。除可以用于研发电子游戏之外，Unity 还是被广泛用于建筑可视化、实时三维动画等类型互动内容的综合型创作工具。

Unity 主要有以下技术特点：
1. 完善的可视化编辑器
    > Unity 引擎的编辑器采用了 “All in one” 的设计思想，即集所有编辑器于一身，包括场景编辑器、资源编辑器、动画编辑器、材质编辑器、游戏对象编辑器等。加之组件化的设计思路，在编辑游戏对象的组件的时候，就好像是在直接编辑这个对象本身，而不是是在使用一个单独的编辑器，它的材质、碰撞器、从属结构等等。并且 Unity 的场景编辑器具有非常好的实时性，即所见即所得，在游戏运行过程中可以实时进行编辑，编辑器会实时反馈效果，这对开发和调试而言可以大大提高效率。
2. 基于 Mono 的脚本开发模式
    > Unity 引擎的底层是使用 C/C++ 语言编写的，然而并没有采用 C/C++ 作为上层逻辑开发的语言，原因是 C/C++ 会带来较高的安全风险和较低的开发效率。Mono 是一个基于 .NET Framework 的开源跨平台运行环境，使用 C# 语言进行开发，使用 Mono 桥接高性能的底层引擎和带有内存管理的安全语言，不仅减少了安全隐患，同时也提高了跨平台的能力。
3. 基于组件的对象系统
    > 在传统的设计当中，我们一般会使用 “派生 - 继承” 来描述对象之间的关系，在游戏设计中，会根据游戏对象的需求来添加各种功能，例如渲染、碰撞检测、动画等，这些通用功能都必须要集成到基类当中，造成游戏对象的基类会变得体积非常大。而基于组件的对象系统，就是把每一个基础功能都独立出来形成一个 “组件 Component”，游戏设计中可以根据游戏对象的需要，将这些组件中的一部分组合到游戏对象中，这样提高了代码可复用度，增加了对象系统的灵活度。
4. 跨平台支持
    > 由于 Unity 采用的是基于 Mono 的上层开发模式，Mono 自身就是跨平台的，开发者编写的 C# 代码会先编译成 CIL（中间语言），在不同平台中运行中会再将 CIL 编译为原生指令。
## <div id="2-3"> 2.3 Node.js 运行环境
Node.js 是一个能够在服务器端运行 JavaScript 的开放源代码、跨平台 JavaScript 运行环境。Node.js 由 Node.js基金会持有和维护，并与 Linux 基金会有合作关系。Node.js 采用 Google 开发的 V8 运行代码，使用事件驱动、非阻塞和异步输入输出模型等技术来提高性能，可优化应用程序的传输量和规模。这些技术通常用于数据密集的即时应用程序。

Node.js 大部分基本模块都用 JavaScript 语言编写。在 Node.js 出现之前，JavaScript 通常作为客户端程序设计语言使用，用 JavaScript 写出的程序常在用户的浏览器上运行。Node.js 的出现使 JavaScript 也能用于服务端编程。Node.js 含有一系列内置模块，使得程序可以脱离 Apache HTTP Server 或 IIS，作为独立服务器运行。

Node.js 主要有以下技术特点：
1. 单线程
    > Node.js 以单线程运行，使用非阻塞 I/O 调用，这样既可以支持数以万计的并发连线，又不会因多线程本身的特点而带来麻烦。众多请求只使用单线程的设计意味着可以用于创建高并发应用程序。Node.js 应用程序的设计目标是任何需要操作 I/O 的函数都使用回调函数。<br><br>
    > 这种设计的缺点是，如果不使用 cluster、StrongLoop Process Manager 或 pm2 等模块，Node.js 就难以处理多核或多线程等情况。
2. V8
    > V8是为 Google Chrome 设计的 JavaScript 运行引擎，Google 于2008年将其开源。V8 用 C++ 编写，它将 JavaScript源代码编译成本地机器码而不是随时解释。<br><br>
    > Node.js 用 libuv 来处理异步事件，而 V8 提供了 JavaScript 的实时运行环境。libuv 是一个网络和文件系统功能的抽象层，既可以用于 Windows 又可以用于匹配 POSIX 标准的系统，例如Linux、macOS 和 Unix。<br><br>
    > Node.js 的核心功能被包含进一个 JavaScript 库，并通过 C++ 将各部分与操作系统进行联系。
3. npm
    > npm 是 Node.js 附带的包管理器。npm 是一个命令行工具，用于从 NPM Registry 中下载、安装 Node.js 程序，同时解决依赖问题。npm 提高了开发的速度，因为它能够负责第三方 Node.js 程序的安装与管理。
4. 统一 API
    > Node.js 将浏览器、数据（例如 MongoDB 或 CouchDB）等组合到一起，通过 JSON 提供一个统一的接口。由于前端框架和一些基本的后端开发技术（如 MVC、MVP、MVVM 等）变得流行，Node.js 也支持客户端和服务器端重新利用相同的模型和接口。
5. 事件循环
    > Node.js 将其注册到操作系统中，这样可以及时注意到新连接的产生。当新连接产生时，操作系统会产生一个回调。在 Node.js 运行时内部，每个连接都被分配一个小型的堆。与其他服务器程序不同的是，Node.js 不使用进程或线程处理连接，而是采用事件循环来处理并发连接。而且 Node.js 的事件循环不需要手动调用。在回调函数定义之后，服务器进入事件循环。当回调函数均被执行完毕之后，Node.js 结束事件循环。
## <div id="2-4"> 2.4 本章小结
本章主要叙述了本篇论文工作中的主要技术，客户端开发中为游戏引擎技术，服务端开发中为 Node.js，并详细介绍了 Unity 和 Node.js 的技术特点。 

# 第三章 需求分析
## 3.1 业务描述
## 3.2 整体需求
## 3.3 功能需求
### 3.3.1 主体功能分析
### 3.3.2 场景功能分析
